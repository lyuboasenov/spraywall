"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[1907],{3875:(F,b,a)=>{a.d(b,{S:()=>y});var y=function(r){return r[r.Hold="Hold"]="Hold",r[r.StartingHold="StartingHold"]="StartingHold",r[r.FinishingHold="FinishingHold"]="FinishingHold",r[r.FootHold="FootHold"]="FootHold",r}(y||{})},8795:(F,b,a)=>{a.d(b,{Y:()=>y});var y=function(r){return r[r.Boulder=0]="Boulder",r[r.Route=1]="Route",r}(y||{})},3245:(F,b,a)=>{a.d(b,{v:()=>H});var y=a(467),r=a(1562),C=a(8795),m=function(h){return h[h.FeetFollow=0]="FeetFollow",h[h.OpenFeet=1]="OpenFeet",h[h.NoMatches=2]="NoMatches",h[h.NoFeet=4]="NoFeet",h}(m||{}),A=a(5312),I=a(4438),M=a(2420),T=a(5332);let H=(()=>{var h;class o{constructor(t,e){this.appwrite=t,this.auth=e,this._routeCollectionId=A.c.AppWrite.Collections.Routes,this._logCollectionId=A.c.AppWrite.Collections.Logs,this.routeDifficulty=new Map,this.boulderDifficulty=new Map,this.routeStyles=new Map,this.routeTypes=new Map,this.holdBuffer=[],this.filter={RouteType:void 0,RouteStyle:void 0,MinDifficulty:void 0,MaxDifficulty:void 0,Angle:void 0,ExcludeMyAscends:void 0},this.routeTypes.set(C.Y.Boulder,"Boulder"),this.routeTypes.set(C.Y.Route,"Route"),this.routeStyles.set(m.FeetFollow,"Feet follow hands"),this.routeStyles.set(m.OpenFeet,"Open feet"),this.routeStyles.set(m.NoMatches,"No matching"),this.routeStyles.set(m.NoFeet,"No feet / Campusing"),this.boulderDifficulty.set(20,"3"),this.boulderDifficulty.set(25,"4-"),this.boulderDifficulty.set(30,"4"),this.boulderDifficulty.set(35,"4+"),this.boulderDifficulty.set(40,"5-"),this.boulderDifficulty.set(45,"5"),this.boulderDifficulty.set(50,"5+"),this.boulderDifficulty.set(55,"6A"),this.boulderDifficulty.set(60,"6A+"),this.boulderDifficulty.set(65,"6B"),this.boulderDifficulty.set(70,"6B+"),this.boulderDifficulty.set(75,"6C"),this.boulderDifficulty.set(80,"6C+"),this.boulderDifficulty.set(85,"7A"),this.boulderDifficulty.set(90,"7A+"),this.boulderDifficulty.set(95,"7B"),this.boulderDifficulty.set(100,"7B+"),this.boulderDifficulty.set(105,"7C"),this.boulderDifficulty.set(110,"7C+"),this.boulderDifficulty.set(115,"8A"),this.boulderDifficulty.set(120,"8A+"),this.boulderDifficulty.set(125,"8B"),this.boulderDifficulty.set(130,"8B+"),this.boulderDifficulty.set(135,"8C"),this.boulderDifficulty.set(140,"8C+"),this.boulderDifficulty.set(145,"9A"),this.routeDifficulty.set(20,"5b+"),this.routeDifficulty.set(25,"5c"),this.routeDifficulty.set(30,"5c+"),this.routeDifficulty.set(35,"6a"),this.routeDifficulty.set(40,"6a+"),this.routeDifficulty.set(45,"6b"),this.routeDifficulty.set(50,"6b+"),this.routeDifficulty.set(55,"6c"),this.routeDifficulty.set(60,"6c+"),this.routeDifficulty.set(65,"7a"),this.routeDifficulty.set(70,"7a+"),this.routeDifficulty.set(75,"7b"),this.routeDifficulty.set(80,"7b+"),this.routeDifficulty.set(85,"7c"),this.routeDifficulty.set(90,"7c+"),this.routeDifficulty.set(95,"8a"),this.routeDifficulty.set(100,"8a+"),this.routeDifficulty.set(105,"8b"),this.routeDifficulty.set(110,"8b+"),this.routeDifficulty.set(115,"8c"),this.routeDifficulty.set(120,"8c+"),this.routeDifficulty.set(125,"9a"),this.routeDifficulty.set(130,"9a+"),this.routeDifficulty.set(135,"9b"),this.routeDifficulty.set(140,"9b+"),this.routeDifficulty.set(145,"9c"),this._db=new r.Lv(this.appwrite.client)}getAll(){var t=this;return(0,y.A)(function*(){let e=[],l=[];l.push(r.XK.select(["$id","Name","Difficulty","Angle","Type"])),l.push(r.XK.limit(1e5)),l.push(r.XK.orderAsc("Difficulty")),t.filter.Angle&&l.push(r.XK.equal("Angle",[t.filter.Angle])),t.filter.RouteType&&l.push(r.XK.equal("Type",[t.filter.RouteType])),t.filter.RouteStyle&&l.push(r.XK.equal("Style",[t.filter.RouteStyle])),t.filter.MinDifficulty&&l.push(r.XK.greaterThanEqual("Difficulty",Number(t.filter.MinDifficulty))),t.filter.MaxDifficulty&&l.push(r.XK.lessThanEqual("Difficulty",Number(t.filter.MaxDifficulty))),t.filter.SetBy&&l.push(r.XK.search("CreatedByName",t.filter.SetBy));const i=yield t._db.listDocuments(t.appwrite.DatabaseId,t._routeCollectionId,l);let n=[];var s,u;t.filter.ExcludeMyAscends&&(n=(yield t._db.listDocuments(t.appwrite.DatabaseId,t._logCollectionId,[r.XK.select(["Route.$id"]),r.XK.equal("CreatedById",null!==(s=null===(u=t.auth.user.value)||void 0===u?void 0:u.id)&&void 0!==s?s:"invalid-user-id")])).documents.map(function(c){return c.Route.$id}));for(let D of i.documents){var p;if(t.filter.ExcludeMyAscends&&n.includes(D.$id))continue;let c=t.boulderDifficulty.get(D.Difficulty);D.Type===C.Y.Route&&(c=t.routeDifficulty.get(D.Difficulty)),e.push({Id:D.$id,Name:D.Name,Angle:D.Angle,Difficulty:null!==(p=c)&&void 0!==p?p:"unknown",Type:D.Type})}return e})()}getById(t){var e=this;return(0,y.A)(function*(){var l,i,n,s;const u=yield e._db.getDocument(e.appwrite.DatabaseId,e._routeCollectionId,t),p=yield e._db.listDocuments(e.appwrite.DatabaseId,e._logCollectionId,[r.XK.equal("Route",[u.$id]),r.XK.orderAsc("$createdAt")]);let D=0,c=0;const f=[];for(const g of p.documents){c+=g.Rating;let _=0==u.Type?e.boulderDifficulty.get(u.Difficulty):e.routeDifficulty.get(u.Difficulty);_||(_="unknown"),f.push({Date:new Date(g.$createdAt).toDateString(),Difficulty:_,Rating:g.Rating,Comment:g.Comment,User:g.CreatedByName})}p.total>0&&(D=c/p.total);let S=[];for(let g of JSON.parse(u.JsonHolds))S.push({Type:g[2],Center:{X:g[0][0],Y:g[0][1]}});let w=e.boulderDifficulty.get(u.Difficulty),v=e.boulderDifficulty.get(u.SettersDifficulty);return u.Type===C.Y.Route&&(w=e.routeDifficulty.get(u.Difficulty),v=e.routeDifficulty.get(u.SettersDifficulty)),{Id:u.$id,Name:u.Name,Description:u.Description,Angle:u.Angle,Difficulty:null!==(l=w)&&void 0!==l?l:"unknown",DifficultyNumber:u.Difficulty,SettersAngle:u.SettersAngle,SettersDifficulty:null!==(i=v)&&void 0!==i?i:"unknown",Autor:u.CreatedByName,Holds:S,Style:null!==(n=e.routeStyles.get(u.Style))&&void 0!==n?n:"Unknown",Type:null!==(s=e.routeTypes.get(u.Type))&&void 0!==s?s:"Unknown",RouteType:u.Type,Rating:D,Sends:f}})()}create(t,e,l,i,n,s,u,p,D=[]){var c=this;return(0,y.A)(function*(){const f=yield c.auth.user.value;let S=[];for(let v of p)S.push([[v.TemplateHold.Center.X,v.TemplateHold.Center.Y],v.TemplateHold.Radius,v.Type]);const w=yield c._db.createDocument(c.appwrite.DatabaseId,c._routeCollectionId,r.ID.unique(),{Name:l,Description:i,Angle:s,Difficulty:n,CreatedById:null==f?void 0:f.id,CreatedByName:null==f?void 0:f.name,Type:e,Style:u,FAById:null==f?void 0:f.id,FAByName:null==f?void 0:f.name,JsonHolds:JSON.stringify(S),SettersAngle:s,SettersDifficulty:n,Wall:t});for(const v of D){const g=v-s;let _=Number(n)+Number(g);0!=g&&(_=Math.min(_,145),_=Math.max(_,0),yield c._db.createDocument(c.appwrite.DatabaseId,c._routeCollectionId,r.ID.unique(),{Name:l,Description:i,Angle:v,Difficulty:_,CreatedById:null==f?void 0:f.id,CreatedByName:null==f?void 0:f.name,Type:e,Style:u,JsonHolds:JSON.stringify(S),SettersAngle:s,SettersDifficulty:n,ParentId:w.$id,Wall:t}))}return c.lastRouteAngle=s,c.lastRouteDifficulty=n,c.lastRouteStyle=u,c.lastRouteType=e,w.$id})()}logSend(t,e,l,i){var n=this;return(0,y.A)(function*(){const s=yield n.auth.user.value;yield n._db.createDocument(n.appwrite.DatabaseId,n._logCollectionId,r.ID.unique(),{Route:t,Comment:e,Rating:i,Difficulty:l,CreatedById:null==s?void 0:s.id,CreatedByName:null==s?void 0:s.name})})()}}return(h=o).\u0275fac=function(t){return new(t||h)(I.KVO(M.k),I.KVO(T.u))},h.\u0275prov=I.jDH({token:h,factory:h.\u0275fac,providedIn:"root"}),o})()},4943:(F,b,a)=>{a.d(b,{s:()=>M});var y=a(467),r=a(5312),C=a(1562),m=a(3875),A=a(4438),I=a(2420);let M=(()=>{var T;class H{constructor(o){this.appwrite=o,this._img=new Image,this._imgLoaded=!1,this._templateLoaded=!1,this._collectionId=r.c.AppWrite.Collections.WallTemplates,this.width=0,this.height=0,this._db=new C.Lv(o.client),this._img.onload=d=>{this.width=this._img.width,this.height=this._img.height,this._imgLoaded=!0},this.getTemplate()}getTemplate(){var o=this;return(0,y.A)(function*(){var d,t,e;if(!o._template){const i=(yield o._db.listDocuments(o.appwrite.DatabaseId,o._collectionId)).documents[0].$id,s=(yield o._db.getDocument(o.appwrite.DatabaseId,o._collectionId,i)).TemplateURL,p=yield(yield fetch(s)).json();o._template={Id:i,EncodedImage:p.EncodedImage,Holds:o.TransformHolds(p.Holds),Angles:p.Angles}}return null!==(d=o._template)&&void 0!==d&&d.EncodedImage&&(o._img.src="data:image/jpeg;base64, "+(null===(e=o._template)||void 0===e?void 0:e.EncodedImage)),null!==(t=o._template)&&void 0!==t?t:null})()}markHolds(o,d,t){let e=t.getContext("2d");if(e&&o)for(let l=0;l<o.length;l++){const i=o[l];e.save(),e.beginPath(),e.moveTo(i.TemplateHold.Contour[0].X,i.TemplateHold.Contour[0].Y);for(let n=1;n<i.TemplateHold.Contour.length;n++)e.lineTo(i.TemplateHold.Contour[n].X,i.TemplateHold.Contour[n].Y);e.lineTo(i.TemplateHold.Contour[0].X,i.TemplateHold.Contour[0].Y),e.closePath(),e.clip(),e.drawImage(this._img,0,0),e.restore(),e.save(),e.beginPath(),e.arc(i.TemplateHold.Center.X,i.TemplateHold.Center.Y,i.TemplateHold.Radius+10,0,2*Math.PI,!0),e.closePath(),e.lineWidth=5,e.strokeStyle=i.Type==m.S.StartingHold?"#00FF00":i.Type==m.S.FinishingHold?"#FF0000":i.Type==m.S.FootHold?"#ffe066":"#00FFFF",e.stroke(),e.restore(),i==d&&(e.save(),e.beginPath(),e.arc(i.TemplateHold.Center.X,i.TemplateHold.Center.Y,i.TemplateHold.Radius+20,0,2*Math.PI,!0),e.closePath(),e.lineWidth=5,e.strokeStyle=i.Type==m.S.StartingHold?"#00FF00":i.Type==m.S.FinishingHold?"#FF0000":i.Type==m.S.FootHold?"#ffe066":"#00FFFF",e.stroke(),e.restore())}}drawTemplateBackdrop(o){var d=this;return(0,y.A)(function*(){for(d._templateLoaded||(yield d.getTemplate());!d._imgLoaded;)yield new Promise(s=>setTimeout(s,500));o.width=d._img.width,o.height=d._img.height;var t=o.getContext("2d");if(t){t.save(),t.drawImage(d._img,0,0),t.restore(),t.save();for(var e=t.getImageData(0,0,d.width,d.height),l=e.data,i=0;i<l.length;i+=4){let s=.3;var n=.299*l[i]*s+.587*l[i+1]*s+.114*l[i+2]*s;l[i]=Math.round(n),l[i+1]=Math.round(n),l[i+2]=Math.round(n)}t.putImageData(e,0,0),t.restore()}})()}findHold(o,d){var t=this;return(0,y.A)(function*(){var e;if(null!==(e=t._template)&&void 0!==e&&e.Holds){var l;let s,i=null===(l=t._template)||void 0===l?void 0:l.Holds,n=null;return i.forEach(u=>{t.regionMatch(o,d,u.MinRect)&&(null==s||s>u.MinRect.Size.Width*u.MinRect.Size.Height)&&(n=u)}),n}return null})()}regionMatch(o,d,t){let e=t.Size.Width/2,l=t.Size.Height/2;return t.Center.X-e<o&&t.Center.X+e>o&&t.Center.Y-l<d&&t.Center.Y+l>d}TransformHolds(o){const d=[];for(const t of o){const e={X:t[0][0],Y:t[0][1]},l=t[1],i={Center:{X:t[2][0][0],Y:t[2][0][1]},Size:{Width:t[2][1][0],Height:t[2][1][1]},Angle:t[2][2]},n=[];for(let s=0;s<t[3].length;s++)n.push({X:t[3][s][0],Y:t[3][s][1]});d.push({Center:e,MinRect:i,Contour:n,Radius:l})}return d}}return(T=H).\u0275fac=function(o){return new(o||T)(A.KVO(I.k))},T.\u0275prov=A.jDH({token:T,factory:T.\u0275fac,providedIn:"root"}),H})()}}]);