"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[2948],{2948:(B,k,d)=>{d.r(k),d.d(k,{AddRoutePageModule:()=>M});var v=d(177),r=d(4341),a=d(9364),y=d(8986),u=d(467),f=d(7700),m=d(9480),e=d(4438),T=d(2167),F=d(4943),R=d(2542);const A=["canvas"],S=["zoom"];function j(n,s){if(1&n&&(e.j41(0,"ion-select-option",26),e.EFF(1),e.k0s()),2&n){const l=s.$implicit;e.FS9("value",l),e.R7$(),e.JRh(l)}}function P(n,s){if(1&n&&(e.j41(0,"ion-select-option",26),e.EFF(1),e.k0s()),2&n){const l=s.$implicit;e.FS9("value",l.key),e.R7$(),e.JRh(l.value)}}function G(n,s){if(1&n&&(e.j41(0,"ion-select-option",26),e.EFF(1),e.k0s()),2&n){const l=s.$implicit;e.FS9("value",l),e.R7$(),e.SpI("",l,"\xb0")}}function E(n,s){if(1&n&&(e.j41(0,"ion-item")(1,"ion-select",27),e.DNE(2,G,2,2,"ion-select-option",16),e.k0s()()),2&n){const l=e.XpG();e.R7$(2),e.Y8G("ngForOf",null==l.template?null:l.template.Angles)}}function H(n,s){if(1&n&&(e.j41(0,"ion-select-option",26),e.EFF(1),e.k0s()),2&n){const l=s.$implicit;e.FS9("value",l),e.R7$(),e.JRh(l)}}function C(n,s){1&n&&(e.j41(0,"div"),e.EFF(1," Select at least starting and finishing holds "),e.k0s())}function b(n,s){if(1&n){const l=e.RV6();e.j41(0,"ion-item-sliding",28),e.bIt("click",function(){const t=e.eBV(l).$implicit,i=e.XpG();return e.Njj(i.selectHold(t))}),e.j41(1,"ion-item",29)(2,"ion-label"),e.EFF(3),e.k0s(),e.nrm(4,"ion-icon",30),e.k0s(),e.j41(5,"ion-item-options")(6,"ion-item-option",31),e.bIt("click",function(){const t=e.eBV(l).$implicit,i=e.XpG();return e.Njj(i.changeTypeStartingHold(t))}),e.EFF(7," Starting hold "),e.k0s(),e.j41(8,"ion-item-option",32),e.bIt("click",function(){const t=e.eBV(l).$implicit,i=e.XpG();return e.Njj(i.changeTypeFinishingHold(t))}),e.EFF(9," Finishing hold "),e.k0s(),e.j41(10,"ion-item-option",33),e.bIt("click",function(){const t=e.eBV(l).$implicit,i=e.XpG();return e.Njj(i.changeTypeFootHold(t))}),e.EFF(11," Foot hold "),e.k0s(),e.j41(12,"ion-item-option",34),e.bIt("click",function(){const t=e.eBV(l).$implicit,i=e.XpG();return e.Njj(i.changeTypeRegularHold(t))}),e.EFF(13," Regular hold "),e.k0s()()()}if(2&n){const l=s.$implicit;e.R7$(),e.Y8G("button",!0),e.R7$(2),e.JRh(l.Type)}}const $=[{path:"",component:(()=>{var n;class s{constructor(o,t,i,c){this.routeService=o,this.wallTemplateService=t,this.formBuilder=i,this.router=c,this.template=null,this.holds=[],this._selectedHold=null,this.routeStyles=[m.Z.FeetFollow,m.Z.OpenFeet,m.Z.NoMatches],this.routeTypes=[m.Y.Boulder,m.Y.Route],this.difficulties=new Map,this.selectHoldsValidator=g=>this.holds.length>1?null:{missingHolds:!0},this.setDifficulty(o.boulderDifficulty),this.formGroup=i.group({routeType:["",r.k0.compose([r.k0.required])],name:["",r.k0.compose([r.k0.required])],description:["",r.k0.compose([])],selectedDifficulty:["",r.k0.compose([r.k0.required])],angle:["",r.k0.compose([r.k0.required])],routeStyle:["",r.k0.compose([r.k0.required])]},{validators:this.selectHoldsValidator})}ngOnInit(){var o=this;return(0,u.A)(function*(){var t,i,c;o.wallTemplateService.drawTemplateBackdrop(o.canvas.nativeElement),o.template=yield o.wallTemplateService.getTemplate();let p=null===(t=o.template)||void 0===t?void 0:t.Angles[0];var h,_;null!==(i=null===(c=o.template)||void 0===c?void 0:c.Angles.length)&&void 0!==i&&i&&(p=null!==(h=null===(_=o.template)||void 0===_?void 0:_.Angles[o.template.Angles.length/2])&&void 0!==h?h:40),o.formGroup=o.formBuilder.group({name:["",r.k0.required],routeType:[m.Y.Boulder,r.k0.required],selectedDifficulty:["",r.k0.required],angle:[p,r.k0.required],routeStyle:[m.Z.FeetFollow,r.k0.required]},{validators:o.selectHoldsValidator})})()}onSubmit(o){var t=this;return(0,u.A)(function*(){console.log(o),t.router.navigateByUrl("/routes",{replaceUrl:!0})})()}selectHold(o){var t=this;return(0,u.A)(function*(){t._selectedHold=o;const i=t.canvas.nativeElement;yield t.wallTemplateService.drawTemplateBackdrop(i),yield t.wallTemplateService.markHolds(t.holds,t._selectedHold,i)})()}changeRouteType(o){var t=this;return(0,u.A)(function*(){const i=o.detail.value;i===m.Y.Route?t.setDifficulty(t.routeService.routeDifficulty):i===m.Y.Boulder&&t.setDifficulty(t.routeService.boulderDifficulty)})()}setDifficulty(o){var t=this;return(0,u.A)(function*(){t.difficulties.clear();for(let[i,c]of o)t.difficulties.set(i,c)})()}changeTypeStartingHold(o){var t=this;return(0,u.A)(function*(){yield t.changeType(o,f.S.StartingHold)})()}changeTypeFinishingHold(o){var t=this;return(0,u.A)(function*(){yield t.changeType(o,f.S.FinishingHold)})()}changeTypeFootHold(o){var t=this;return(0,u.A)(function*(){yield t.changeType(o,f.S.FootHold)})()}changeTypeRegularHold(o){var t=this;return(0,u.A)(function*(){yield t.changeType(o,f.S.Hold)})()}changeType(o,t){var i=this;return(0,u.A)(function*(){o.Type=t;const c=i.canvas.nativeElement;yield i.wallTemplateService.drawTemplateBackdrop(c),yield i.wallTemplateService.markHolds(i.holds,i._selectedHold,c)})()}templateClick(o){var t=this;return(0,u.A)(function*(){const i=Math.min(t.wallTemplateService.width/o.target.offsetWidth,t.wallTemplateService.height/o.target.offsetHeight),c=(o.layerX+(o.target.offsetWidth-o.target.parentElement.clientWidth)/2)*i,g=(o.layerY+(o.target.offsetHeight-o.target.parentElement.clientHeight)/2)*i,p=yield t.wallTemplateService.findHold(c,g);if(p)if(p.Type=0==t.holds.length?f.S.StartingHold:f.S.Hold,t.holds.includes(p)){let _=t.holds.indexOf(p);t.holds.splice(_,1)}else t.holds.push(p);const h=t.canvas.nativeElement;yield t.wallTemplateService.drawTemplateBackdrop(h),yield t.wallTemplateService.markHolds(t.holds,t._selectedHold,h),t.formGroup.controls.routeStyle.updateValueAndValidity()})()}}return(n=s).\u0275fac=function(o){return new(o||n)(e.rXU(T.v),e.rXU(F.s),e.rXU(r.ok),e.rXU(y.Ix))},n.\u0275cmp=e.VBU({type:n,selectors:[["app-add-route"]],viewQuery:function(o,t){if(1&o&&(e.GBs(A,7),e.GBs(S,7)),2&o){let i;e.mGM(i=e.lsd())&&(t.canvas=i.first),e.mGM(i=e.lsd())&&(t.zoom=i.first)}},outputs:{holds:"holds",routeStyles:"routeStyles",routeTypes:"routeTypes",difficulties:"difficulties"},decls:47,vars:14,consts:[["zoom",""],["canvas",""],[3,"translucent"],["slot","secondary"],["fill","solid","routerLink","/routes"],["name","close-circle-outline"],["slot","primary"],["fill","solid","form","form","type","submit",3,"disabled"],["name","save-outline"],[3,"fullscreen"],["collapse","condense"],["size","large"],["id","container"],[1,"capitalize"],["id","form",3,"ngSubmit","formGroup"],["formControlName","routeType","placeholder","Select route type","interface","action-sheet",3,"ionChange"],[3,"value",4,"ngFor","ngForOf"],["formControlName","name","label","Name","placeholder","Enter route name","required","true"],["formControlName","description","label","Description","placeholder","Enter route description"],["formControlName","selectedDifficulty","label","Difficulty","placeholder","Select route difficulty","interface","action-sheet","required","true"],[4,"ngIf"],["formControlName","routeStyle","placeholder","Select route type","interface","action-sheet","required","true"],[3,"limit-zoom"],["width","1500","height","700",3,"click"],["required","true",3,"inset"],[3,"click",4,"ngFor","ngForOf"],[3,"value"],["formControlName","angle","label","Angle","placeholder","Select board angle","interface","action-sheet","required","true"],[3,"click"],[3,"button"],["name","chevron-back-outline","slot","end"],["color","success",3,"click"],["color","danger",3,"click"],["color","warning",3,"click"],["color","light","expandable","true",3,"click"]],template:function(o,t){if(1&o){const i=e.RV6();e.j41(0,"ion-header",2)(1,"ion-toolbar")(2,"ion-buttons",3)(3,"ion-button",4),e.nrm(4,"ion-icon",5),e.EFF(5," CANCEL "),e.k0s()(),e.j41(6,"ion-buttons",6)(7,"ion-button",7),e.nrm(8,"ion-icon",8),e.EFF(9," SAVE "),e.k0s()(),e.j41(10,"ion-title"),e.EFF(11,"Add new route"),e.k0s()()(),e.j41(12,"ion-content",9)(13,"ion-header",10)(14,"ion-toolbar"),e.nrm(15,"ion-title",11),e.k0s()(),e.j41(16,"div",12),e.nrm(17,"strong",13),e.j41(18,"form",14),e.bIt("ngSubmit",function(){return e.eBV(i),e.Njj(t.onSubmit(t.formGroup.value))}),e.j41(19,"ion-list")(20,"ion-item")(21,"ion-select",15),e.bIt("ionChange",function(g){return e.eBV(i),e.Njj(t.changeRouteType(g))}),e.DNE(22,j,2,2,"ion-select-option",16),e.k0s()(),e.j41(23,"ion-item"),e.nrm(24,"ion-input",17),e.k0s(),e.j41(25,"ion-item"),e.nrm(26,"ion-textarea",18),e.k0s(),e.j41(27,"ion-item")(28,"ion-select",19),e.DNE(29,P,2,2,"ion-select-option",16),e.nI1(30,"keyvalue"),e.k0s()(),e.DNE(31,E,3,1,"ion-item",20),e.j41(32,"ion-item")(33,"ion-select",21),e.DNE(34,H,2,2,"ion-select-option",16),e.k0s()(),e.j41(35,"ion-item"),e.DNE(36,C,2,0,"div",20),e.k0s(),e.j41(37,"ion-item")(38,"pinch-zoom",22,0)(40,"canvas",23,1),e.bIt("click",function(g){return e.eBV(i),e.Njj(t.templateClick(g))}),e.EFF(42," Not supported on this browser "),e.k0s()()(),e.j41(43,"ion-list",24)(44,"ion-list-header"),e.EFF(45,"Marked holds"),e.k0s(),e.DNE(46,b,14,2,"ion-item-sliding",25),e.k0s()()()()()}if(2&o){let i;e.Y8G("translucent",!0),e.R7$(7),e.Y8G("disabled",!t.formGroup.valid),e.R7$(5),e.Y8G("fullscreen",!0),e.R7$(6),e.Y8G("formGroup",t.formGroup),e.R7$(4),e.Y8G("ngForOf",t.routeTypes),e.R7$(7),e.Y8G("ngForOf",e.bMT(30,12,t.difficulties)),e.R7$(2),e.Y8G("ngIf",(null!==(i=null==t.template||null==t.template.Angles?null:t.template.Angles.length)&&void 0!==i?i:0)>1),e.R7$(3),e.Y8G("ngForOf",t.routeStyles),e.R7$(2),e.Y8G("ngIf",t.formGroup.hasError("missingHolds")),e.R7$(2),e.Y8G("limit-zoom",20),e.R7$(5),e.Y8G("inset",!0),e.R7$(3),e.Y8G("ngForOf",t.holds)}},dependencies:[v.Sq,v.bT,r.qT,r.BC,r.cb,r.YS,a.Jm,a.QW,a.W9,a.eU,a.iq,a.$w,a.uz,a.LU,a.CE,a.A7,a.he,a.nf,a.AF,a.Nm,a.Ip,a.nc,a.BC,a.ai,a.Je,a.Gw,a.N7,y.Wk,R.Hg,r.j4,r.JD,v.lG],styles:["ion-menu-button[_ngcontent-%COMP%]{color:var(--ion-color-primary)}#container[_ngcontent-%COMP%]{text-align:center}#container[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{font-size:20px;line-height:26px}#container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:16px;line-height:22px;color:#8c8c8c;margin:0}#container[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{text-decoration:none}#container[_ngcontent-%COMP%]   pinch-zoom[_ngcontent-%COMP%]{height:50em;margin:2em}"]}),s})()}];let N=(()=>{var n;class s{}return(n=s).\u0275fac=function(o){return new(o||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[y.iI.forChild($),y.iI]}),s})(),M=(()=>{var n;class s{}return(n=s).\u0275fac=function(o){return new(o||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[v.MD,r.YN,a.bv,N,R.Ud,r.X1]}),s})()}}]);