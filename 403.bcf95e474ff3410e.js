"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[403],{9480:(M,A,h)=>{h.d(A,{Y:()=>g,Z:()=>o});var g=function(r){return r[r.Boulder="Boulder"]="Boulder",r[r.Route="Route"]="Route",r}(g||{}),o=function(r){return r[r.FeetFollow="FeetFollow"]="FeetFollow",r[r.OpenFeet="OpenFeet"]="OpenFeet",r[r.NoMatches="NoMatches"]="NoMatches",r}(o||{})},7700:(M,A,h)=>{h.d(A,{S:()=>g});var g=function(o){return o[o.Hold="Hold"]="Hold",o[o.StartingHold="StartingHold"]="StartingHold",o[o.FinishingHold="FinishingHold"]="FinishingHold",o[o.FootHold="FootHold"]="FootHold",o}(g||{})},403:(M,A,h)=>{h.r(A),h.d(A,{AddRouteDetailsPageModule:()=>u});var g=h(177),o=h(4341),r=h(9364),b=h(8986),R=h(467),v=h(9480),e=h(4438),F=h(2167),C=h(4943);function T(i,s){if(1&i&&(e.j41(0,"ion-select-option",19),e.EFF(1),e.k0s()),2&i){const c=s.$implicit;e.FS9("value",c),e.R7$(),e.JRh(c)}}function m(i,s){if(1&i&&(e.j41(0,"ion-select-option",19),e.EFF(1),e.k0s()),2&i){const c=s.$implicit;e.FS9("value",c.key),e.R7$(),e.JRh(c.value)}}function _(i,s){if(1&i&&(e.j41(0,"ion-select-option",19),e.EFF(1),e.k0s()),2&i){const c=s.$implicit;e.FS9("value",c),e.R7$(),e.SpI("",c,"\xb0")}}function l(i,s){if(1&i&&(e.j41(0,"ion-item")(1,"ion-select",20),e.DNE(2,_,2,2,"ion-select-option",13),e.k0s()()),2&i){const c=e.XpG();e.R7$(2),e.Y8G("ngForOf",null==c.template?null:c.template.Angles)}}function n(i,s){if(1&i&&(e.j41(0,"ion-select-option",19),e.EFF(1),e.k0s()),2&i){const c=s.$implicit;e.FS9("value",c),e.R7$(),e.JRh(c)}}const t=[{path:"",component:(()=>{var i;class s{constructor(f,d,y,D){this.routeService=f,this.wallTemplateService=d,this.formBuilder=y,this.router=D,this.template=null,this.routeStyles=[v.Z.FeetFollow,v.Z.OpenFeet,v.Z.NoMatches],this.routeTypes=[v.Y.Boulder,v.Y.Route],this.difficulties=new Map,this.formGroup=y.group({name:["",o.k0.required],description:["",o.k0.required],routeType:[v.Y.Boulder,o.k0.required],difficulty:["",o.k0.required],routeStyle:[v.Z.FeetFollow,o.k0.required]})}ngOnInit(){var f=this;return(0,R.A)(function*(){var d,y,D;f.template=yield f.wallTemplateService.getTemplate(),f.setDifficulty(f.routeService.boulderDifficulty);let E=null===(d=f.template)||void 0===d?void 0:d.Angles[0];var S,I;null!==(y=null===(D=f.template)||void 0===D?void 0:D.Angles.length)&&void 0!==y&&y&&(E=null!==(S=null===(I=f.template)||void 0===I?void 0:I.Angles[f.template.Angles.length/2])&&void 0!==S?S:40),f.formGroup=f.formBuilder.group({name:["",o.k0.required],description:["",o.k0.required],routeType:[v.Y.Boulder,o.k0.required],difficulty:["",o.k0.required],angle:[E,o.k0.required],routeStyle:[v.Z.FeetFollow,o.k0.required]})})()}onSubmit(f){var d=this;return(0,R.A)(function*(){var y,D;const E=null!==(y=null===(D=d.template)||void 0===D?void 0:D.Angles)&&void 0!==y?y:[],S=yield d.routeService.create(f.routeType,f.name,f.description,f.difficulty,f.angle,f.routeStyle,d.routeService.holdBuffer,E);d.router.navigateByUrl("/routes/"+S,{replaceUrl:!0})})()}setDifficulty(f){var d=this;return(0,R.A)(function*(){d.difficulties.clear();for(let[y,D]of f)d.difficulties.set(y,D)})()}changeRouteType(f){var d=this;return(0,R.A)(function*(){const y=f.detail.value;y===v.Y.Route?d.setDifficulty(d.routeService.routeDifficulty):y===v.Y.Boulder&&d.setDifficulty(d.routeService.boulderDifficulty)})()}}return(i=s).\u0275fac=function(f){return new(f||i)(e.rXU(F.v),e.rXU(C.s),e.rXU(o.ok),e.rXU(b.Ix))},i.\u0275cmp=e.VBU({type:i,selectors:[["app-add-route-details"]],outputs:{routeStyles:"routeStyles",routeTypes:"routeTypes",difficulties:"difficulties"},decls:34,vars:10,consts:[[3,"translucent"],["slot","primary"],["fill","solid","routerLink","/routes"],["name","close-circle-outline"],["fill","solid","routerLink","details","form","form","type","submit",3,"disabled"],["name","save-outline"],[3,"fullscreen"],["collapse","condense"],["size","large"],["id","container"],[1,"capitalize"],["id","form",3,"ngSubmit","formGroup"],["formControlName","routeType","placeholder","Select route type","interface","action-sheet",3,"ionChange"],[3,"value",4,"ngFor","ngForOf"],["formControlName","name","label","Name","placeholder","Enter route name","required","true"],["formControlName","description","label","Description","placeholder","Enter route description"],["formControlName","difficulty","label","Difficulty","placeholder","Select route difficulty","interface","action-sheet","required","true"],[4,"ngIf"],["formControlName","routeStyle","placeholder","Select route type","interface","action-sheet","required","true"],[3,"value"],["formControlName","angle","label","Angle","placeholder","Select board angle","interface","action-sheet","required","true"]],template:function(f,d){if(1&f&&(e.j41(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-buttons",1)(3,"ion-button",2),e.nrm(4,"ion-icon",3),e.k0s()(),e.j41(5,"ion-buttons",1)(6,"ion-button",4),e.nrm(7,"ion-icon",5),e.k0s()(),e.j41(8,"ion-title"),e.EFF(9,"New route"),e.k0s()()(),e.j41(10,"ion-content",6)(11,"ion-header",7)(12,"ion-toolbar")(13,"ion-title",8),e.EFF(14,"add-route-details"),e.k0s()()(),e.j41(15,"div",9),e.nrm(16,"strong",10),e.j41(17,"form",11),e.bIt("ngSubmit",function(){return d.onSubmit(d.formGroup.value)}),e.j41(18,"ion-list")(19,"ion-item")(20,"ion-select",12),e.bIt("ionChange",function(D){return d.changeRouteType(D)}),e.DNE(21,T,2,2,"ion-select-option",13),e.k0s()(),e.j41(22,"ion-item"),e.nrm(23,"ion-input",14),e.k0s(),e.j41(24,"ion-item"),e.nrm(25,"ion-textarea",15),e.k0s(),e.j41(26,"ion-item")(27,"ion-select",16),e.DNE(28,m,2,2,"ion-select-option",13),e.nI1(29,"keyvalue"),e.k0s()(),e.DNE(30,l,3,1,"ion-item",17),e.j41(31,"ion-item")(32,"ion-select",18),e.DNE(33,n,2,2,"ion-select-option",13),e.k0s()()()()()()),2&f){let y;e.Y8G("translucent",!0),e.R7$(6),e.Y8G("disabled",!d.formGroup.valid),e.R7$(4),e.Y8G("fullscreen",!0),e.R7$(7),e.Y8G("formGroup",d.formGroup),e.R7$(4),e.Y8G("ngForOf",d.routeTypes),e.R7$(7),e.Y8G("ngForOf",e.bMT(29,8,d.difficulties)),e.R7$(2),e.Y8G("ngIf",(null!==(y=null==d.template||null==d.template.Angles?null:d.template.Angles.length)&&void 0!==y?y:0)>1),e.R7$(3),e.Y8G("ngForOf",d.routeStyles)}},dependencies:[g.Sq,g.bT,o.qT,o.BC,o.cb,o.YS,r.Jm,r.QW,r.W9,r.eU,r.iq,r.$w,r.uz,r.nf,r.Nm,r.Ip,r.nc,r.BC,r.ai,r.Je,r.Gw,r.N7,b.Wk,o.j4,o.JD,g.lG]}),s})()}];let p=(()=>{var i;class s{}return(i=s).\u0275fac=function(f){return new(f||i)},i.\u0275mod=e.$C({type:i}),i.\u0275inj=e.G2t({imports:[b.iI.forChild(t),b.iI]}),s})(),u=(()=>{var i;class s{}return(i=s).\u0275fac=function(f){return new(f||i)},i.\u0275mod=e.$C({type:i}),i.\u0275inj=e.G2t({imports:[g.MD,o.YN,r.bv,p,o.X1]}),s})()},2167:(M,A,h)=>{h.d(A,{v:()=>e});var g=h(467),o=h(9480),r=h(1562),b=h(4438),R=h(2420),v=h(4796);let e=(()=>{var F;class C{constructor(m,_){this.appwrite=m,this.auth=_,this._routeCollectionId="66126500b72562898ef7",this.routeDifficulty=new Map,this.boulderDifficulty=new Map,this.holdBuffer=[],this.filter={RouteType:void 0,RouteStyle:void 0,MinDifficulty:void 0,MaxDifficulty:void 0,Angle:void 0},this.boulderDifficulty.set(20,"3"),this.boulderDifficulty.set(25,"4-"),this.boulderDifficulty.set(30,"4"),this.boulderDifficulty.set(35,"4+"),this.boulderDifficulty.set(40,"5-"),this.boulderDifficulty.set(45,"5"),this.boulderDifficulty.set(50,"5+"),this.boulderDifficulty.set(55,"6A"),this.boulderDifficulty.set(60,"6A+"),this.boulderDifficulty.set(65,"6B"),this.boulderDifficulty.set(70,"6B+"),this.boulderDifficulty.set(75,"6C"),this.boulderDifficulty.set(80,"6C+"),this.boulderDifficulty.set(85,"7A"),this.boulderDifficulty.set(90,"7A+"),this.boulderDifficulty.set(95,"7B"),this.boulderDifficulty.set(100,"7B+"),this.boulderDifficulty.set(105,"7C"),this.boulderDifficulty.set(110,"7C+"),this.boulderDifficulty.set(115,"8A"),this.boulderDifficulty.set(120,"8A+"),this.boulderDifficulty.set(125,"8B"),this.boulderDifficulty.set(130,"8B+"),this.boulderDifficulty.set(135,"8C"),this.boulderDifficulty.set(140,"8C+"),this.boulderDifficulty.set(145,"9A"),this.routeDifficulty.set(20,"5b+"),this.routeDifficulty.set(25,"5c"),this.routeDifficulty.set(30,"5c+"),this.routeDifficulty.set(35,"6a"),this.routeDifficulty.set(40,"6a+"),this.routeDifficulty.set(45,"6b"),this.routeDifficulty.set(50,"6b+"),this.routeDifficulty.set(55,"6c"),this.routeDifficulty.set(60,"6c+"),this.routeDifficulty.set(65,"7a"),this.routeDifficulty.set(70,"7a+"),this.routeDifficulty.set(75,"7b"),this.routeDifficulty.set(80,"7b+"),this.routeDifficulty.set(85,"7c"),this.routeDifficulty.set(90,"7c+"),this.routeDifficulty.set(95,"8a"),this.routeDifficulty.set(100,"8a+"),this.routeDifficulty.set(105,"8b"),this.routeDifficulty.set(110,"8b+"),this.routeDifficulty.set(115,"8c"),this.routeDifficulty.set(120,"8c+"),this.routeDifficulty.set(125,"9a"),this.routeDifficulty.set(130,"9a+"),this.routeDifficulty.set(135,"9b"),this.routeDifficulty.set(140,"9b+"),this.routeDifficulty.set(145,"9c"),this._db=new r.Lv(this.appwrite.client)}getAll(){var m=this;return(0,g.A)(function*(){let _=[],l=[];l.push(r.XK.select(["$id","Name","Difficulty","Angle","Type"])),m.filter.Angle&&l.push(r.XK.equal("Angle",[m.filter.Angle])),m.filter.RouteType&&l.push(r.XK.equal("RouteType",[m.filter.RouteType])),m.filter.RouteStyle&&l.push(r.XK.equal("RouteStyle",[m.filter.RouteStyle])),m.filter.MinDifficulty&&l.push(r.XK.greaterThanEqual("Difficulty",Number(m.filter.MinDifficulty))),m.filter.MaxDifficulty&&l.push(r.XK.lessThanEqual("Difficulty",Number(m.filter.MaxDifficulty)));const n=yield m._db.listDocuments(m.appwrite.DatabaseId,m._routeCollectionId,l);for(let t of n.documents){var a;let p=m.boulderDifficulty.get(t.Difficulty);t.Type===o.Y.Route&&(p=m.routeDifficulty.get(t.Difficulty)),_.push({Id:t.$id,Name:t.Name,Angle:t.Angle,Difficulty:null!==(a=p)&&void 0!==a?a:"unknown",Type:t.Type})}return _})()}getById(m){var _=this;return(0,g.A)(function*(){var l;const n=yield _._db.getDocument(_.appwrite.DatabaseId,_._routeCollectionId,m);let a=[];for(let p of n.Holds)a.push({Type:p.Type,Center:p.Center,MinRect:{Center:p.Center,Size:"",Angle:0},Contour:[],Radius:0});let t=_.boulderDifficulty.get(n.Difficulty);return n.Type===o.Y.Route&&(t=_.routeDifficulty.get(n.Difficulty)),{Id:n.$id,Name:n.Name,Description:n.Description,Angle:n.Angle,Difficulty:null!==(l=t)&&void 0!==l?l:"unknown",Autor:n.CreatedByName,Holds:a,Style:n.Style,Type:n.Type,Rating:5}})()}create(m,_,l,n,a,t,p,u=[]){var i=this;return(0,g.A)(function*(){const s=yield i.auth.getUser();let c=[];for(let d of p)c.push({Type:d.Type,Center:d.Center});const f=yield i._db.createDocument(i.appwrite.DatabaseId,i._routeCollectionId,r.ID.unique(),{Name:_,Description:l,Angle:a,Difficulty:n,CreatedById:s.$id,CreatedByName:s.name,Holds:c,Type:m,Style:t,FAById:s.$id,FAByName:s.name});for(const d of u){const y=d-a;let D=Number(n)+Number(y);0!=y&&(D=Math.min(D,145),D=Math.max(D,0),yield i._db.createDocument(i.appwrite.DatabaseId,i._routeCollectionId,r.ID.unique(),{Name:_,Description:l,Angle:d,Difficulty:D,CreatedById:s.$id,CreatedByName:s.name,Holds:c,Type:m,Style:t,FAById:s.$id,FAByName:s.name}))}return f.$id})()}}return(F=C).\u0275fac=function(m){return new(m||F)(b.KVO(R.k),b.KVO(v.u))},F.\u0275prov=b.jDH({token:F,factory:F.\u0275fac,providedIn:"root"}),C})()},4943:(M,A,h)=>{h.d(A,{s:()=>C});var g=h(467),o=h(7700),b=(h(5312),h(1562)),R=h(4438),v=h(2420);let C=(()=>{var T;class m{constructor(l){this.appwrite=l,this._img=new Image,this._imgLoaded=!1,this._templateLoaded=!1,this._collectionId="661264719e62da3812a6",this.width=0,this.height=0,this._db=new b.Lv(l.client),this._img.onload=n=>{this.width=this._img.width,this.height=this._img.height,this._imgLoaded=!0},this.getTemplate()}getTemplate(){var l=this;return(0,g.A)(function*(){var n,a,t;if(!l._template){const u=(yield l._db.listDocuments(l.appwrite.DatabaseId,l._collectionId)).documents[0].$id,s=(yield l._db.getDocument(l.appwrite.DatabaseId,l._collectionId,u)).TemplateURL,c=yield fetch(s);l._template=yield c.json()}return null!==(n=l._template)&&void 0!==n&&n.EncodedImage&&(l._img.src="data:image/jpeg;base64, "+(null===(t=l._template)||void 0===t?void 0:t.EncodedImage)),null!==(a=l._template)&&void 0!==a?a:null})()}markHolds(l,n,a){let t=a.getContext("2d");if(t&&l)for(let p=0;p<l.length;p++){const u=l[p];t.save(),t.beginPath(),t.moveTo(u.Contour[0].X,u.Contour[0].Y);for(let i=1;i<u.Contour.length;i++)t.lineTo(u.Contour[i].X,u.Contour[i].Y);t.lineTo(u.Contour[0].X,u.Contour[0].Y),t.closePath(),t.clip(),t.drawImage(this._img,0,0),t.restore(),t.save(),t.beginPath(),t.arc(u.Center.X,u.Center.Y,u.Radius+10,0,2*Math.PI,!0),t.closePath(),t.lineWidth=5,t.strokeStyle=u.Type==o.S.StartingHold?"#00FF00":u.Type==o.S.FinishingHold?"#FF0000":u.Type==o.S.FootHold?"#ffe066":"#00FFFF",t.stroke(),t.restore(),u==n&&(t.save(),t.beginPath(),t.arc(u.Center.X,u.Center.Y,u.Radius+20,0,2*Math.PI,!0),t.closePath(),t.lineWidth=5,t.strokeStyle=u.Type==o.S.StartingHold?"#00FF00":u.Type==o.S.FinishingHold?"#FF0000":u.Type==o.S.FootHold?"#ffe066":"#00FFFF",t.stroke(),t.restore())}}drawTemplateBackdrop(l){var n=this;return(0,g.A)(function*(){for(n._templateLoaded||(yield n.getTemplate());!n._imgLoaded;)yield new Promise(s=>setTimeout(s,500));l.width=n._img.width,l.height=n._img.height;var a=l.getContext("2d");if(a){a.save(),a.drawImage(n._img,0,0),a.restore(),a.save();for(var t=a.getImageData(0,0,n.width,n.height),p=t.data,u=0;u<p.length;u+=4){let s=.3;var i=.299*p[u]*s+.587*p[u+1]*s+.114*p[u+2]*s;p[u]=Math.round(i),p[u+1]=Math.round(i),p[u+2]=Math.round(i)}a.putImageData(t,0,0),a.restore()}})()}findHold(l,n){var a=this;return(0,g.A)(function*(){var t;if(null!==(t=a._template)&&void 0!==t&&t.Holds){var p;let s,u=null===(p=a._template)||void 0===p?void 0:p.Holds,i=null;return u.forEach(c=>{a.regionMatch(l,n,c.MinRect)&&(null==s||s>c.MinRect.Size.Width*c.MinRect.Size.Height)&&(i=c)}),i}return null})()}regionMatch(l,n,a){let t=a.Size.Width/2,p=a.Size.Height/2;return a.Center.X-t<l&&a.Center.X+t>l&&a.Center.Y-p<n&&a.Center.Y+p>n}}return(T=m).\u0275fac=function(l){return new(l||T)(R.KVO(v.k))},T.\u0275prov=R.jDH({token:T,factory:T.\u0275fac,providedIn:"root"}),m})()}}]);