"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[9520],{9520:(U,M,s)=>{s.r(M),s.d(M,{ViewRoutePageModule:()=>G});var P=s(177),w=s(4341),d=s(9364),v=s(8986),C=s(467),e=s(4438),O=s(2167),V=s(4943),p=s(2542);const F=["canvas"],X=["zoom"],Y=["zoomContainer"];function H(i,c){1&i&&e.nrm(0,"ion-icon",17)}const S=[{path:"",component:(()=>{var i;class c{constructor(t,n,a){this.routeService=t,this.wallTemplateService=n,this.router=a,this.routes=[],this.activatedRoute=(0,e.WQX)(v.nX),this._discoveredHolds=[],this.schemaSize=500,this.rating=new Array(0),this.handlePan=(o,l,u)=>{o.scale<o.minPanScale||o.properties.disablePan||(o.startX=l.x,o.startY=l.y,o.eventType="pan",o.moveX=o.initialMoveX+(u.x-l.x),o.moveY=o.initialMoveY+(u.y-l.y),o.properties.limitPan&&(o.limitPanY(),o.limitPanX()),o.scale>o.minPanScale&&o.centeringImage(),o.transformElement(0))}}ngOnInit(){var t=this;return(0,C.A)(function*(){t.id=t.activatedRoute.snapshot.paramMap.get("id");const n=yield t.routeService.getById(t.id),a=t.canvas.nativeElement;yield t.wallTemplateService.drawTemplateBackdrop(a),n?(t.route=n,yield t.markHolds(),setTimeout(()=>t.zoomToRoute(),100)):t.router.navigateByUrl("not-found",{replaceUrl:!0})})()}zoomToRoute(){var t=this;return(0,C.A)(function*(){if(t._discoveredHolds&&t._discoveredHolds.length>0){let n=6e4,a=0,o=6e4,l=0;const u=HTMLDivElement=t.zoomContainer.nativeElement,z=t.canvas.nativeElement,f=z.width,R=z.height;for(const r of t._discoveredHolds)r&&(n>r.Center.X-r.Radius&&(n=Math.max(0,r.Center.X-r.Radius)),a<r.Center.X+r.Radius&&(a=Math.min(f,r.Center.X+r.Radius)),o>r.Center.Y-r.Radius&&(o=Math.max(0,r.Center.Y-r.Radius)),l<r.Center.Y+r.Radius&&(l=Math.min(R,r.Center.Y+r.Radius)));const y=l-o,T=a-n,h=Math.max(f/u.clientWidth,R/u.clientHeight);let g=Math.min(f/T,R/y);t.zoom.toggleZoom(),g=t.zoom.pinchZoom.scale,t.handlePan(t.zoom.pinchZoom,{x:(n+a)*g/(2*h),y:(o+l)*g/(2*h)},{x:f*g/(2*h),y:y*g/(2*h)})}})()}markHolds(){var t=this;return(0,C.A)(function*(){for(const l of null!==(n=null===(a=t.route)||void 0===a?void 0:a.Holds)&&void 0!==n?n:[]){var n,a;const u=yield t.wallTemplateService.findHold(l.Center.X,l.Center.Y);u&&(l.Contour=u.Contour,l.MinRect=u.MinRect,l.Radius=u.Radius,t._discoveredHolds.push(l))}t.wallTemplateService.markHolds(t._discoveredHolds,null,t.canvas.nativeElement)})()}}return(i=c).\u0275fac=function(t){return new(t||i)(e.rXU(O.v),e.rXU(V.s),e.rXU(v.Ix))},i.\u0275cmp=e.VBU({type:i,selectors:[["app-view-route"]],viewQuery:function(t,n){if(1&t&&(e.GBs(F,7),e.GBs(X,7),e.GBs(Y,7)),2&t){let a;e.mGM(a=e.lsd())&&(n.canvas=a.first),e.mGM(a=e.lsd())&&(n.zoom=a.first),e.mGM(a=e.lsd())&&(n.zoomContainer=a.first)}},decls:28,vars:14,consts:[["zoomContainer",""],["zoom",""],["canvas",""],[3,"translucent"],["slot","start"],[3,"fullscreen"],["collapse","condense"],["size","large"],["id","container"],["id","zoomContainer"],[3,"limit-zoom"],["width","1500","height","700"],["id","info"],["id","rating"],["name","star-outline",4,"ngFor","ngForOf"],[1,"description"],[1,"author"],["name","star-outline"]],template:function(t,n){1&t&&(e.j41(0,"ion-header",3)(1,"ion-toolbar")(2,"ion-buttons",4),e.nrm(3,"ion-menu-button"),e.k0s(),e.j41(4,"ion-title"),e.EFF(5),e.k0s()()(),e.j41(6,"ion-content",5)(7,"ion-header",6)(8,"ion-toolbar")(9,"ion-title",7),e.EFF(10),e.k0s()()(),e.j41(11,"div",8)(12,"div",9,0)(14,"pinch-zoom",10,1)(16,"canvas",11,2),e.EFF(18," Not supported on this browser "),e.k0s()()(),e.j41(19,"div",12)(20,"div",13),e.DNE(21,H,1,0,"ion-icon",14),e.k0s(),e.j41(22,"p")(23,"span",15),e.EFF(24),e.k0s()(),e.j41(25,"p")(26,"span",16),e.EFF(27),e.k0s()()()()()),2&t&&(e.Y8G("translucent",!0),e.R7$(5),e.E5c("",null==n.route?null:n.route.Name," [ ",null==n.route?null:n.route.Difficulty," @ ",null==n.route?null:n.route.Angle,"\xb0 ] "),e.R7$(),e.Y8G("fullscreen",!0),e.R7$(4),e.JRh(null==n.route?null:n.route.Name),e.R7$(4),e.xc7("width",n.schemaSize)("height",n.schemaSize),e.Y8G("limit-zoom",20),e.R7$(7),e.Y8G("ngForOf",n.rating),e.R7$(3),e.JRh(null==n.route?null:n.route.Description),e.R7$(3),e.SpI("by ",null==n.route?null:n.route.Autor,""))},dependencies:[P.Sq,d.QW,d.W9,d.eU,d.iq,d.MC,d.BC,d.ai,p.Hg],styles:["ion-menu-button[_ngcontent-%COMP%]{color:var(--ion-color-primary)}#container[_ngcontent-%COMP%]{text-align:center}#container[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{font-size:20px;line-height:26px}#container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:16px;line-height:22px;color:#8c8c8c;margin:0}#container[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{text-decoration:none}#container[_ngcontent-%COMP%]   #zoomContainer[_ngcontent-%COMP%]{margin-right:2em}#container[_ngcontent-%COMP%]   #zoomContainer[_ngcontent-%COMP%]   pinch-zoom[_ngcontent-%COMP%]{height:50em}#container[_ngcontent-%COMP%]   #rating[_ngcontent-%COMP%]{float:right}#container[_ngcontent-%COMP%]   #info[_ngcontent-%COMP%]{text-align:left;padding:1em}.author[_ngcontent-%COMP%]{font-size:.8em}"]}),c})()}];let E=(()=>{var i;class c{}return(i=c).\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.$C({type:i}),i.\u0275inj=e.G2t({imports:[v.iI.forChild(S),v.iI]}),c})(),G=(()=>{var i;class c{}return(i=c).\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.$C({type:i}),i.\u0275inj=e.G2t({imports:[P.MD,w.YN,d.bv,E,p.Ud]}),c})()}}]);