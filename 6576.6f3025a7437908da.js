"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[6576],{7700:(I,b,c)=>{c.d(b,{S:()=>y});var y=function(g){return g[g.Hold="Hold"]="Hold",g[g.StartingHold="StartingHold"]="StartingHold",g[g.FinishingHold="FinishingHold"]="FinishingHold",g[g.FootHold="FootHold"]="FootHold",g}(y||{})},6576:(I,b,c)=>{c.r(b),c.d(b,{ListRoutesPageModule:()=>L});var y=c(177),g=c(4341),d=c(9364),C=c(8986),P=c(467),T=c(9480),t=c(4438),E=c(2167),M=c(4943);const R=i=>[i];function F(i,h){if(1&i&&(t.j41(0,"ion-item",14)(1,"ion-label"),t.EFF(2),t.k0s(),t.j41(3,"ion-note"),t.EFF(4),t.k0s()()),2&i){const l=h.$implicit;t.Y8G("button",!0)("routerLink",t.eq3(5,R,"/routes/"+l.Id)),t.R7$(2),t.JRh(l.Name),t.R7$(2),t.Lme("",l.Difficulty," @ ",l.Angle,"\xb0")}}function m(i,h){if(1&i&&(t.j41(0,"ion-select-option",25),t.EFF(1),t.k0s()),2&i){const l=h.$implicit;t.FS9("value",l),t.R7$(),t.JRh(l)}}function n(i,h){if(1&i&&(t.j41(0,"ion-select-option",25),t.EFF(1),t.k0s()),2&i){const l=h.$implicit;t.FS9("value",l.key),t.R7$(),t.JRh(l.value)}}function a(i,h){if(1&i&&(t.j41(0,"ion-select-option",25),t.EFF(1),t.k0s()),2&i){const l=h.$implicit;t.FS9("value",l.key),t.R7$(),t.JRh(l.value)}}function u(i,h){if(1&i&&(t.j41(0,"ion-select-option",25),t.EFF(1),t.k0s()),2&i){const l=h.$implicit;t.FS9("value",l),t.R7$(),t.SpI("",l,"\xb0")}}function e(i,h){if(1&i){const l=t.RV6();t.j41(0,"ion-item")(1,"ion-select",26),t.mxI("ngModelChange",function(r){t.eBV(l);const _=t.XpG(2);return t.DH7(_.angle,r)||(_.angle=r),t.Njj(r)}),t.DNE(2,u,2,2,"ion-select-option",20),t.k0s()()}if(2&i){const l=t.XpG(2);t.R7$(),t.R50("ngModel",l.angle),t.R7$(),t.Y8G("ngForOf",null==l.template?null:l.template.Angles)}}function f(i,h){if(1&i&&(t.j41(0,"ion-select-option",25),t.EFF(1),t.k0s()),2&i){const l=h.$implicit;t.FS9("value",l),t.R7$(),t.JRh(l)}}function s(i,h){if(1&i){const l=t.RV6();t.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",15)(3,"ion-button",16),t.bIt("click",function(){t.eBV(l);const r=t.XpG();return t.Njj(r.clear())}),t.EFF(4,"CLEAR"),t.k0s()(),t.j41(5,"ion-buttons",1)(6,"ion-button",17),t.bIt("click",function(){t.eBV(l);const r=t.XpG();return t.Njj(r.close())}),t.EFF(7,"CLOSE"),t.k0s()(),t.j41(8,"ion-title"),t.EFF(9,"FILTER"),t.k0s()()(),t.j41(10,"ion-content",18)(11,"ion-list")(12,"ion-item")(13,"ion-select",19),t.mxI("ngModelChange",function(r){t.eBV(l);const _=t.XpG();return t.DH7(_.routeType,r)||(_.routeType=r),t.Njj(r)}),t.DNE(14,m,2,2,"ion-select-option",20),t.k0s()(),t.j41(15,"ion-item")(16,"ion-select",21),t.mxI("ngModelChange",function(r){t.eBV(l);const _=t.XpG();return t.DH7(_.minDifficulty,r)||(_.minDifficulty=r),t.Njj(r)}),t.DNE(17,n,2,2,"ion-select-option",20),t.nI1(18,"keyvalue"),t.k0s()(),t.j41(19,"ion-item")(20,"ion-select",22),t.mxI("ngModelChange",function(r){t.eBV(l);const _=t.XpG();return t.DH7(_.maxDifficulty,r)||(_.maxDifficulty=r),t.Njj(r)}),t.DNE(21,a,2,2,"ion-select-option",20),t.nI1(22,"keyvalue"),t.k0s()(),t.DNE(23,e,3,2,"ion-item",23),t.j41(24,"ion-item")(25,"ion-select",24),t.mxI("ngModelChange",function(r){t.eBV(l);const _=t.XpG();return t.DH7(_.routeStyle,r)||(_.routeStyle=r),t.Njj(r)}),t.DNE(26,f,2,2,"ion-select-option",20),t.k0s()()()()}if(2&i){let l;const o=t.XpG();t.R7$(6),t.Y8G("strong",!0),t.R7$(7),t.R50("ngModel",o.routeType),t.R7$(),t.Y8G("ngForOf",o.routeTypes),t.R7$(2),t.R50("ngModel",o.minDifficulty),t.R7$(),t.Y8G("ngForOf",t.bMT(18,10,o.difficulties)),t.R7$(3),t.R50("ngModel",o.maxDifficulty),t.R7$(),t.Y8G("ngForOf",t.bMT(22,12,o.difficulties)),t.R7$(2),t.Y8G("ngIf",(null!==(l=null==o.template||null==o.template.Angles?null:o.template.Angles.length)&&void 0!==l?l:0)>1),t.R7$(2),t.R50("ngModel",o.routeStyle),t.R7$(),t.Y8G("ngForOf",o.routeStyles)}}const D=[{path:"",component:(()=>{var i;class h{constructor(o,r){this.routeService=o,this.wallTemplateService=r,this.routeStyles=[T.Z.FeetFollow,T.Z.OpenFeet,T.Z.NoMatches],this.routeTypes=[T.Y.Boulder,T.Y.Route],this.difficulties=new Map,this.routes=[],this.template=null,this.routeService.getAll().then(_=>{this.routes=_})}ngOnInit(){var o=this;return(0,P.A)(function*(){o.template=yield o.wallTemplateService.getTemplate(),o.difficulties.clear();for(let[S,O]of o.routeService.boulderDifficulty){var r;const j=null!==(r=o.routeService.routeDifficulty.get(S))&&void 0!==r?r:"unknown";o.difficulties.set(S,O+"/"+j)}const _=Array.from(o.difficulties.keys());o.minDifficulty=_[0],o.maxDifficulty=_[_.length-1]})()}onSelect(o){this.selectedRoute=o}onFilter(){return(0,P.A)(function*(){})()}clear(){this.modal.dismiss(null,"clear")}close(){this.modal.dismiss("ok","close")}onWillDismiss(o){}}return(i=h).\u0275fac=function(o){return new(o||i)(t.rXU(E.v),t.rXU(M.s))},i.\u0275cmp=t.VBU({type:i,selectors:[["app-list-routes"]],viewQuery:function(o,r){if(1&o&&t.GBs(d.Sb,5),2&o){let _;t.mGM(_=t.lsd())&&(r.modal=_.first)}},inputs:{routeStyle:"routeStyle",routeType:"routeType",angle:"angle"},outputs:{routeStyles:"routeStyles",routeTypes:"routeTypes",difficulties:"difficulties"},decls:21,vars:3,consts:[[3,"translucent"],["slot","primary"],["fill","solid","id","open-filter"],["name","filter-circle-outline"],[3,"fullscreen"],["collapse","condense"],["size","large"],["id","container"],[1,"capitalize"],[1,"routes"],[3,"button","routerLink",4,"ngFor","ngForOf"],[1,"fab-add"],["name","add"],["trigger","open-filter",3,"willDismiss"],[3,"button","routerLink"],["slot","secondary"],[3,"click"],[3,"click","strong"],[1,"ion-padding"],["placeholder","Select route type","interface","action-sheet",3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],["label","Min Difficulty","placeholder","Select minimum route difficulty","interface","action-sheet","required","true",3,"ngModelChange","ngModel"],["label","Max Difficulty","placeholder","Select maximum route difficulty","interface","action-sheet","required","true",3,"ngModelChange","ngModel"],[4,"ngIf"],["placeholder","Select route type","interface","action-sheet","required","true",3,"ngModelChange","ngModel"],[3,"value"],["label","Angle","placeholder","Select board angle","interface","action-sheet","required","true",3,"ngModelChange","ngModel"]],template:function(o,r){1&o&&(t.j41(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-buttons",1)(3,"ion-button",2),t.nrm(4,"ion-icon",3),t.k0s()(),t.j41(5,"ion-title"),t.EFF(6,"ROUTES"),t.k0s()()(),t.j41(7,"ion-content",4)(8,"ion-header",5)(9,"ion-toolbar"),t.nrm(10,"ion-title",6),t.k0s()(),t.j41(11,"div",7),t.nrm(12,"strong",8),t.j41(13,"ion-list",9),t.DNE(14,F,5,7,"ion-item",10),t.k0s(),t.j41(15,"div",11)(16,"ion-fab")(17,"ion-fab-button"),t.nrm(18,"ion-icon",12),t.k0s()()()(),t.j41(19,"ion-modal",13),t.bIt("willDismiss",function(S){return r.onWillDismiss(S)}),t.DNE(20,s,27,14,"ng-template"),t.k0s()()),2&o&&(t.Y8G("translucent",!0),t.R7$(7),t.Y8G("fullscreen",!0),t.R7$(7),t.Y8G("ngForOf",r.routes))},dependencies:[y.Sq,y.bT,g.BC,g.YS,g.vS,d.Jm,d.QW,d.W9,d.Q8,d.YW,d.eU,d.iq,d.uz,d.he,d.nf,d.JI,d.Nm,d.Ip,d.BC,d.ai,d.Sb,d.Je,d.N7,C.Wk,y.lG],styles:["ion-menu-button[_ngcontent-%COMP%]{color:var(--ion-color-primary)}#container[_ngcontent-%COMP%]{text-align:center}#container[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{font-size:20px;line-height:26px}#container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:16px;line-height:22px;color:#8c8c8c;margin:0}#container[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{text-decoration:none}ion-note[_ngcontent-%COMP%]{color:var(--ion-color-primary);vertical-align:middle;font-size:.9em;font-weight:300;margin-top:1em}div[_ngcontent-%COMP%]   .fab-add[_ngcontent-%COMP%]{float:right;margin-right:70px;margin-top:10px}"]}),h})()}];let v=(()=>{var i;class h{}return(i=h).\u0275fac=function(o){return new(o||i)},i.\u0275mod=t.$C({type:i}),i.\u0275inj=t.G2t({imports:[C.iI.forChild(D),C.iI]}),h})(),L=(()=>{var i;class h{}return(i=h).\u0275fac=function(o){return new(o||i)},i.\u0275mod=t.$C({type:i}),i.\u0275inj=t.G2t({imports:[y.MD,g.YN,d.bv,v]}),h})()},2167:(I,b,c)=>{c.d(b,{v:()=>E});var y=c(467),d=(c(5312),c(1562)),C=c(4438),P=c(2420),T=c(4796);let E=(()=>{var M;class R{constructor(m,n){this.appwrite=m,this.auth=n,this._pointCollectionId="661266d5049e132c5e15",this._holdCollectionId="661266673efa7698f1f5",this._routeCollectionId="66126500b72562898ef7",this.routeDifficulty=new Map,this.boulderDifficulty=new Map,this.boulderDifficulty.set(20,"3"),this.boulderDifficulty.set(25,"4-"),this.boulderDifficulty.set(30,"4"),this.boulderDifficulty.set(35,"4+"),this.boulderDifficulty.set(40,"5-"),this.boulderDifficulty.set(45,"5"),this.boulderDifficulty.set(50,"5+"),this.boulderDifficulty.set(55,"6A"),this.boulderDifficulty.set(60,"6A+"),this.boulderDifficulty.set(65,"6B"),this.boulderDifficulty.set(70,"6B+"),this.boulderDifficulty.set(75,"6C"),this.boulderDifficulty.set(80,"6C+"),this.boulderDifficulty.set(85,"7A"),this.boulderDifficulty.set(90,"7A+"),this.boulderDifficulty.set(95,"7B"),this.boulderDifficulty.set(100,"7B+"),this.boulderDifficulty.set(105,"7C"),this.boulderDifficulty.set(110,"7C+"),this.boulderDifficulty.set(115,"8A"),this.boulderDifficulty.set(120,"8A+"),this.boulderDifficulty.set(125,"8B"),this.boulderDifficulty.set(130,"8B+"),this.boulderDifficulty.set(135,"8C"),this.boulderDifficulty.set(140,"8C+"),this.boulderDifficulty.set(145,"9A"),this.routeDifficulty.set(20,"5b+"),this.routeDifficulty.set(25,"5c"),this.routeDifficulty.set(30,"5c+"),this.routeDifficulty.set(35,"6a"),this.routeDifficulty.set(40,"6a+"),this.routeDifficulty.set(45,"6b"),this.routeDifficulty.set(50,"6b+"),this.routeDifficulty.set(55,"6c"),this.routeDifficulty.set(60,"6c+"),this.routeDifficulty.set(65,"7a"),this.routeDifficulty.set(70,"7a+"),this.routeDifficulty.set(75,"7b"),this.routeDifficulty.set(80,"7b+"),this.routeDifficulty.set(85,"7c"),this.routeDifficulty.set(90,"7c+"),this.routeDifficulty.set(95,"8a"),this.routeDifficulty.set(100,"8a+"),this.routeDifficulty.set(105,"8b"),this.routeDifficulty.set(110,"8b+"),this.routeDifficulty.set(115,"8c"),this.routeDifficulty.set(120,"8c+"),this.routeDifficulty.set(125,"9a"),this.routeDifficulty.set(130,"9a+"),this.routeDifficulty.set(135,"9b"),this.routeDifficulty.set(140,"9b+"),this.routeDifficulty.set(145,"9c"),this._db=new d.Lv(this.appwrite.client)}getAll(){var m=this;return(0,y.A)(function*(){var n;if(!m.routes){let a=[];const u=yield m._db.listDocuments(m.appwrite.DatabaseId,m._routeCollectionId);for(let e of u.documents){let f=[];for(let s of e.Holds)f.push({Type:s.Type,Center:s.Center,MinRect:{Center:s.Center,Size:"",Angle:0},Contour:[],Radius:0});a.push({Id:e.$id,Name:e.Name,Description:e.Description,Angle:e.Angle,Difficulty:e.Difficulty,Autor:e.CreatedByName,Holds:f,Style:e.Style,Type:e.Type,Rating:5})}m.routes=a}return null!==(n=m.routes)&&void 0!==n?n:[]})()}getById(m){var n=this;return(0,y.A)(function*(){n.routes||(yield n.getAll());for(const u of null!==(a=n.routes)&&void 0!==a?a:[]){var a;if(u.Id===m)return u}return null})()}create(m,n,a,u,e,f,s){var p=this;return(0,y.A)(function*(){const D=yield p.auth.getUser();let v=[];for(let i of s)v.push({Type:i.Type,Center:i.Center});return(yield p._db.createDocument(p.appwrite.DatabaseId,p._routeCollectionId,d.ID.unique(),{Name:n,Description:a,Angle:e,Difficulty:u,CreatedById:D.$id,CreatedByName:D.name,Holds:v,Type:m,Style:f})).$id})()}}return(M=R).\u0275fac=function(m){return new(m||M)(C.KVO(P.k),C.KVO(T.u))},M.\u0275prov=C.jDH({token:M,factory:M.\u0275fac,providedIn:"root"}),R})()},4943:(I,b,c)=>{c.d(b,{s:()=>M});var y=c(467),g=c(7700),C=(c(5312),c(1562)),P=c(4438),T=c(2420);let M=(()=>{var R;class F{constructor(n){this.appwrite=n,this._img=new Image,this._imgLoaded=!1,this._templateLoaded=!1,this._collectionId="661264719e62da3812a6",this.width=0,this.height=0,this._db=new C.Lv(n.client),this._img.onload=a=>{this.width=this._img.width,this.height=this._img.height,this._imgLoaded=!0},this.getTemplate()}getTemplate(){var n=this;return(0,y.A)(function*(){var a,u,e;if(!n._template){const s=(yield n._db.listDocuments(n.appwrite.DatabaseId,n._collectionId)).documents[0].$id,D=(yield n._db.getDocument(n.appwrite.DatabaseId,n._collectionId,s)).TemplateURL,v=yield fetch(D);n._template=yield v.json()}return null!==(a=n._template)&&void 0!==a&&a.EncodedImage&&(n._img.src="data:image/jpeg;base64, "+(null===(e=n._template)||void 0===e?void 0:e.EncodedImage)),null!==(u=n._template)&&void 0!==u?u:null})()}markHolds(n,a,u){let e=u.getContext("2d");if(e&&n)for(let f=0;f<n.length;f++){const s=n[f];e.save(),e.beginPath(),e.moveTo(s.Contour[0].X,s.Contour[0].Y);for(let p=1;p<s.Contour.length;p++)e.lineTo(s.Contour[p].X,s.Contour[p].Y);e.lineTo(s.Contour[0].X,s.Contour[0].Y),e.closePath(),e.clip(),e.drawImage(this._img,0,0),e.restore(),e.save(),e.beginPath(),e.arc(s.Center.X,s.Center.Y,s.Radius+10,0,2*Math.PI,!0),e.closePath(),e.lineWidth=5,e.strokeStyle=s.Type==g.S.StartingHold?"#00FF00":s.Type==g.S.FinishingHold?"#FF0000":s.Type==g.S.FootHold?"#ffe066":"#00FFFF",e.stroke(),e.restore(),s==a&&(e.save(),e.beginPath(),e.arc(s.Center.X,s.Center.Y,s.Radius+20,0,2*Math.PI,!0),e.closePath(),e.lineWidth=5,e.strokeStyle=s.Type==g.S.StartingHold?"#00FF00":s.Type==g.S.FinishingHold?"#FF0000":s.Type==g.S.FootHold?"#ffe066":"#00FFFF",e.stroke(),e.restore())}}drawTemplateBackdrop(n){var a=this;return(0,y.A)(function*(){for(a._templateLoaded||(yield a.getTemplate());!a._imgLoaded;)yield new Promise(D=>setTimeout(D,500));n.width=a._img.width,n.height=a._img.height;var u=n.getContext("2d");if(u){u.save(),u.drawImage(a._img,0,0),u.restore(),u.save();for(var e=u.getImageData(0,0,a.width,a.height),f=e.data,s=0;s<f.length;s+=4){let D=.3;var p=.299*f[s]*D+.587*f[s+1]*D+.114*f[s+2]*D;f[s]=Math.round(p),f[s+1]=Math.round(p),f[s+2]=Math.round(p)}u.putImageData(e,0,0),u.restore()}})()}findHold(n,a){var u=this;return(0,y.A)(function*(){var e;if(null!==(e=u._template)&&void 0!==e&&e.Holds){var f;let D,s=null===(f=u._template)||void 0===f?void 0:f.Holds,p=null;return s.forEach(v=>{u.regionMatch(n,a,v.MinRect)&&(null==D||D>v.MinRect.Size.Width*v.MinRect.Size.Height)&&(p=v)}),p}return null})()}regionMatch(n,a,u){let e=u.Size.Width/2,f=u.Size.Height/2;return u.Center.X-e<n&&u.Center.X+e>n&&u.Center.Y-f<a&&u.Center.Y+f>a}}return(R=F).\u0275fac=function(n){return new(n||R)(P.KVO(T.k))},R.\u0275prov=P.jDH({token:R,factory:R.\u0275fac,providedIn:"root"}),F})()}}]);