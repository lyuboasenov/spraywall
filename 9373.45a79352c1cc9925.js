"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[9373],{9373:(O,y,d)=>{d.r(y),d.d(y,{ViewRouteSchemaPageModule:()=>B});var _=d(177),R=d(4341),s=d(9364),p=d(8986),f=d(467),e=d(4438),C=d(8795),w=d(3245),V=d(4943),H=d(5332),T=d(2542);const j=["canvas"],k=["zoom"],G=["zoomContainer"],b=()=>[];function D(i,u){if(1&i){const l=e.RV6();e.j41(0,"ion-button",19),e.bIt("click",function(){e.eBV(l);const n=e.XpG();return e.Njj(n.openSendModal())}),e.nrm(1,"ion-icon",20),e.k0s()}}function X(i,u){if(1&i&&(e.j41(0,"ion-select-option",29),e.EFF(1),e.k0s()),2&i){const l=u.$implicit;e.FS9("value",l.key),e.R7$(),e.JRh(l.value)}}function F(i,u){if(1&i&&(e.j41(0,"ion-select-option",29),e.EFF(1),e.k0s()),2&i){const l=u.index;e.FS9("value",l),e.R7$(),e.JRh(l+1)}}function z(i,u){if(1&i){const l=e.RV6();e.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",21)(3,"ion-button",22),e.bIt("click",function(){e.eBV(l);const n=e.XpG();return e.Njj(n.close())}),e.EFF(4,"CLOSE"),e.k0s()(),e.j41(5,"ion-buttons",4)(6,"ion-button",23),e.bIt("click",function(){e.eBV(l);const n=e.XpG();return e.Njj(n.send())}),e.EFF(7,"SEND"),e.k0s()(),e.j41(8,"ion-title"),e.EFF(9,"SEND"),e.k0s()()(),e.j41(10,"ion-content",24)(11,"ion-list")(12,"ion-item")(13,"ion-textarea",25),e.mxI("ngModelChange",function(n){e.eBV(l);const o=e.XpG();return e.DH7(o.comment,n)||(o.comment=n),e.Njj(n)}),e.k0s()(),e.j41(14,"ion-item")(15,"ion-select",26),e.mxI("ngModelChange",function(n){e.eBV(l);const o=e.XpG();return e.DH7(o.sendDifficulty,n)||(o.sendDifficulty=n),e.Njj(n)}),e.DNE(16,X,2,2,"ion-select-option",27),e.nI1(17,"keyvalue"),e.k0s()(),e.j41(18,"ion-item")(19,"ion-select",28),e.mxI("ngModelChange",function(n){e.eBV(l);const o=e.XpG();return e.DH7(o.rating,n)||(o.rating=n),e.Njj(n)}),e.DNE(20,F,2,2,"ion-select-option",27),e.k0s()()()()}if(2&i){const l=e.XpG();e.R7$(6),e.Y8G("strong",!0),e.R7$(7),e.R50("ngModel",l.comment),e.R7$(2),e.R50("ngModel",l.sendDifficulty),e.R7$(),e.Y8G("ngForOf",e.bMT(17,6,l.difficulties)),e.R7$(3),e.R50("ngModel",l.rating),e.R7$(),e.Y8G("ngForOf",e.lJ4(8,b).constructor(6))}}const E=[{path:"",component:(()=>{var i;class u{constructor(t,n,o,c,m){this.routeService=t,this.wallTemplateService=n,this.router=o,this.loadingCtrl=c,this.auth=m,this.user=null,this.activatedRoute=(0,e.WQX)(p.nX),this._discoveredHolds=[],this.isSendModalOpen=!1,this.difficulties=new Map,this.handlePan=(a,g,h)=>{a.scale<a.minPanScale||a.properties.disablePan||(a.startX=g.x,a.startY=g.y,a.eventType="pan",a.moveX=a.initialMoveX+(h.x-g.x),a.moveY=a.initialMoveY+(h.y-g.y),a.properties.limitPan&&(a.limitPanY(),a.limitPanX()),a.scale>a.minPanScale&&a.centeringImage(),a.transformElement(0))}}ngOnInit(){var t=this;return(0,f.A)(function*(){t.auth.user.subscribe(c=>{t.user=c}),yield t.showLoading(),t.id=t.activatedRoute.snapshot.paramMap.get("id");const n=yield t.routeService.getById(t.id);t.difficulties.clear(),(null==n?void 0:n.RouteType)==C.Y.Boulder?t.difficulties=t.routeService.boulderDifficulty:(null==n?void 0:n.RouteType)==C.Y.Route&&(t.difficulties=t.routeService.routeDifficulty),t.sendDifficulty=null==n?void 0:n.DifficultyNumber;const o=t.canvas.nativeElement;yield t.wallTemplateService.drawTemplateBackdrop(o),n?(t.route=n,yield t.markHolds(),setTimeout(()=>t.zoomToRoute(),100)):t.router.navigateByUrl("/not-found",{replaceUrl:!0}),t.loading.dismiss()})()}showLoading(){var t=this;return(0,f.A)(function*(){t.loading=yield t.loadingCtrl.create({message:"Loading route ..."}),t.loading.present()})()}zoomToRoute(){var t=this;return(0,f.A)(function*(){if(t._discoveredHolds&&t._discoveredHolds.length>0){let n=6e4,o=0,c=6e4,m=0;const a=HTMLDivElement=t.zoomContainer.nativeElement,g=t.canvas.nativeElement,h=g.width,M=g.height;for(const r of t._discoveredHolds)r&&(n>r.TemplateHold.Center.X-r.TemplateHold.Radius&&(n=Math.max(0,r.TemplateHold.Center.X-r.TemplateHold.Radius)),o<r.TemplateHold.Center.X+r.TemplateHold.Radius&&(o=Math.min(h,r.TemplateHold.Center.X+r.TemplateHold.Radius)),c>r.TemplateHold.Center.Y-r.TemplateHold.Radius&&(c=Math.max(0,r.TemplateHold.Center.Y-r.TemplateHold.Radius)),m<r.TemplateHold.Center.Y+r.TemplateHold.Radius&&(m=Math.min(M,r.TemplateHold.Center.Y+r.TemplateHold.Radius)));const P=m-c,N=o-n,S=Math.max(h/a.clientWidth,M/a.clientHeight);let v=Math.min(h/N,M/P);t.zoom.toggleZoom(),v=t.zoom.pinchZoom.scale,t.handlePan(t.zoom.pinchZoom,{x:(n+o)*v/(2*S),y:(c+m)*v/(2*S)},{x:h*v/(2*S),y:P*v/(2*S)})}})()}markHolds(){var t=this;return(0,f.A)(function*(){for(const m of null!==(n=null===(o=t.route)||void 0===o?void 0:o.Holds)&&void 0!==n?n:[]){var n,o;const a=yield t.wallTemplateService.findHold(m.Center.X,m.Center.Y);a&&t._discoveredHolds.push({TemplateHold:a,Type:m.Type})}t.wallTemplateService.markHolds(t._discoveredHolds,null,t.canvas.nativeElement)})()}openSendModal(){var t=this;return(0,f.A)(function*(){t.isSendModalOpen=!0})()}send(){var t=this;return(0,f.A)(function*(){yield t.modal.dismiss("ok","send")})()}close(){var t=this;return(0,f.A)(function*(){yield t.modal.dismiss(null,"close")})()}onWillDismiss(t){var n=this;return(0,f.A)(function*(){var c;"send"===t.detail.role&&(yield n.routeService.logSend(null===(c=n.route)||void 0===c?void 0:c.Id,n.comment,n.sendDifficulty,n.rating)),n.isSendModalOpen=!1})()}}return(i=u).\u0275fac=function(t){return new(t||i)(e.rXU(w.v),e.rXU(V.s),e.rXU(p.Ix),e.rXU(s.Xi),e.rXU(H.u))},i.\u0275cmp=e.VBU({type:i,selectors:[["app-view-route-schema"]],viewQuery:function(t,n){if(1&t&&(e.GBs(s.Sb,5),e.GBs(j,7),e.GBs(k,7),e.GBs(G,7)),2&t){let o;e.mGM(o=e.lsd())&&(n.modal=o.first),e.mGM(o=e.lsd())&&(n.canvas=o.first),e.mGM(o=e.lsd())&&(n.zoom=o.first),e.mGM(o=e.lsd())&&(n.zoomContainer=o.first)}},inputs:{user:"user"},outputs:{difficulties:"difficulties"},decls:26,vars:8,consts:[["zoomContainer",""],["zoom",""],["canvas",""],[3,"translucent"],["slot","primary"],["fill","solid",3,"click",4,"ngIf"],["fill","solid","routerLink","details"],["name","information-circle-outline"],["slot","start"],["fill","solid","routerLink","/routes"],["name","chevron-back-outline"],[3,"fullscreen"],["collapse","condense"],["size","large"],["id","container"],["id","zoomContainer"],["id","zoom",3,"limit-zoom"],["width","1500","height","700"],[3,"willDismiss","isOpen"],["fill","solid",3,"click"],["name","checkmark-outline"],["slot","secondary"],[3,"click"],[3,"click","strong"],[1,"ion-padding"],["label","Comment","placeholder","Enter send comment",3,"ngModelChange","ngModel"],["label","Difficulty","placeholder","Select route difficulty","interface","action-sheet","required","true",3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],["label","Rating","placeholder","Select route rating","interface","action-sheet","required","true",3,"ngModelChange","ngModel"],[3,"value"]],template:function(t,n){if(1&t){const o=e.RV6();e.j41(0,"ion-header",3)(1,"ion-toolbar")(2,"ion-buttons",4),e.DNE(3,D,2,0,"ion-button",5),e.j41(4,"ion-button",6),e.nrm(5,"ion-icon",7),e.k0s()(),e.j41(6,"ion-title"),e.EFF(7),e.k0s(),e.j41(8,"ion-buttons",8)(9,"ion-button",9),e.nrm(10,"ion-icon",10),e.k0s()()()(),e.j41(11,"ion-content",11)(12,"ion-header",12)(13,"ion-toolbar")(14,"ion-title",13),e.EFF(15,"view-route-schema"),e.k0s()()(),e.j41(16,"div",14)(17,"div",15,0)(19,"pinch-zoom",16,1)(21,"canvas",17,2),e.EFF(23," Not supported on this browser "),e.k0s()()()(),e.j41(24,"ion-modal",18),e.bIt("willDismiss",function(m){return e.eBV(o),e.Njj(n.onWillDismiss(m))}),e.DNE(25,z,21,9,"ng-template"),e.k0s()()}2&t&&(e.Y8G("translucent",!0),e.R7$(3),e.Y8G("ngIf",n.user),e.R7$(4),e.E5c("",null==n.route?null:n.route.Name," [ ",null==n.route?null:n.route.Difficulty," @ ",null==n.route?null:n.route.Angle,"\xb0 ] "),e.R7$(4),e.Y8G("fullscreen",!0),e.R7$(8),e.Y8G("limit-zoom",20),e.R7$(5),e.Y8G("isOpen",n.isSendModalOpen))},dependencies:[_.Sq,_.bT,R.BC,R.YS,R.vS,s.Jm,s.QW,s.W9,s.eU,s.iq,s.uz,s.nf,s.Nm,s.Ip,s.nc,s.BC,s.ai,s.Sb,s.Je,s.Gw,s.N7,p.Wk,T.Hg,_.lG],styles:["#container[_ngcontent-%COMP%], #container[_ngcontent-%COMP%]   #zoomContainer[_ngcontent-%COMP%], #container[_ngcontent-%COMP%]   #zoomContainer[_ngcontent-%COMP%]   #zoom[_ngcontent-%COMP%]{width:100%;height:100%}"]}),u})()}];let Y=(()=>{var i;class u{}return(i=u).\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.$C({type:i}),i.\u0275inj=e.G2t({imports:[p.iI.forChild(E),p.iI]}),u})(),B=(()=>{var i;class u{}return(i=u).\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.$C({type:i}),i.\u0275inj=e.G2t({imports:[_.MD,R.YN,s.bv,Y,T.Ud]}),u})()}}]);